<!DOCTYPE html><html><head>	<script src="jquery-1.8.1.js" type="text/javascript"></script></head><body>	<video id="source-video" width="560" height="340" controls><!--		<source type="video/webm" src="Metal_Dust_Trailer_small.webm"></source> -->		<source type="video/webm" src="Road Blaster.webm"></source><!--		<source type="video/webm" src="Star Rider.webm"></source> -->	</video>	<canvas id="thumbnail-canvas" width="64" height="48"></canvas>	<canvas id="preview-canvas" width="256" height="192"></canvas>	<input type="button" id="botao-iniciar" value="Iniciar" />	<script>		var sourceVideo = document.getElementById('source-video');		var thumbnailCanvas = document.getElementById('thumbnail-canvas');		var previewCanvas = document.getElementById('preview-canvas');				$('#botao-iniciar').click(function(){			sourceVideo.width = sourceVideo.videoWidth;			sourceVideo.height = sourceVideo.videoHeight;						ctx = thumbnailCanvas.getContext('2d');			ctx2 = previewCanvas.getContext('2d');						if (!sourceVideo.timerCallback) {				sourceVideo.timerCallback = function() {				  if (sourceVideo.paused || sourceVideo.ended) {					setTimeout(sourceVideo.timerCallback, 0);					return;				  }				  computeFrame();				  setTimeout(sourceVideo.timerCallback, 0);				}								function computeFrame() {					ctx.drawImage(sourceVideo, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);										var frame = ctx.getImageData(0, 0, thumbnailCanvas.width, thumbnailCanvas.height);										var indexes = [];					var palette = [						{r: 0, g: 0, b: 0, ct: 0},						{r: 0, g: 0, b: 0, ct: 0},						{r: 0, g: 0, b: 0, ct: 0},						{r: 0, g: 0, b: 0, ct: 0}					];										var l = frame.data.length / 4;					for (var i = 0; i < l; i++) {						  var r = frame.data[i * 4 + 0];						  var g = frame.data[i * 4 + 1];						  var b = frame.data[i * 4 + 2];						  						  var shade = (r + g + b) / 3;						  var index = shade >> 6;						  var color = index << 6;						  						  indexes.push(index);						  palette[index].r += r;						  palette[index].g += g;						  palette[index].b += b;						  palette[index].ct++;/*						  frame.data[i * 4 + 0] = color;						  frame.data[i * 4 + 1] = color;						  frame.data[i * 4 + 2] = color;						  */						 					}					palette.forEach(function(entry){						entry.r /= entry.ct;						entry.g /= entry.ct;						entry.b /= entry.ct;						entry.r &= 0xC0;						entry.g &= 0xC0;						entry.b &= 0xC0;					});					for (var i = 0; i < l; i++) {						var pal = palette[indexes[i]];						frame.data[i * 4 + 0] = pal.r;						frame.data[i * 4 + 1] = pal.g;						frame.data[i * 4 + 2] = pal.b;						  					}					ctx.putImageData(frame, 0, 0);										ctx2.mozImageSmoothingEnabled=false;					ctx2.drawImage(thumbnailCanvas, 0, 0, previewCanvas.width, previewCanvas.height);				}				sourceVideo.timerCallback();			}						sourceVideo.play();		});	</script></body></html>