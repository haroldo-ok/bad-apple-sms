<!DOCTYPE html><html><head>	<style TYPE="text/css">		dl		{			display: inline-block;		}	</style>	<script src="jquery-1.8.1.js" type="text/javascript"></script>	<script src="base64.js" type="text/javascript"></script></head><body>		<dl>		<dt>Image width x height (in tiles)</dt>		<dd>			<input id="tile-count-x" value="24" /> 			x			<input id="tile-count-y" value="18" /> 		</dd>		<dt>Frame rate</dt>		<dd>			<input id="frame-rate" value="30" /> 		</dd>	</dl>	<div>		<dl>			<dt>Original video</dt>			<dd>				<video id="source-video" width="560" height="340">					<source src="Touhou - Bad Apple [English vocal by Cristina Vee].mp4" type="video/mp4"/>				</video>			</dd>		</dl>		<dl>			<dt>Reduced image</dt>			<dd><canvas id="preview-canvas" width="256" height="192"></canvas></dd>			<dt>Monochrome image</dt>			<dd><canvas id="preview-canvas2" width="256" height="192"></canvas></dd>		</dl>		<input type="button" id="botao-iniciar" value="Iniciar" />	</div>		<div>		<p>Compressed</p>		Hex	<textarea id="hexdata"></textarea>		Base64 <textarea id="base64"></textarea>	</div>	<div>		<p>Uncompressed</p>		Hex	<textarea id="hexdatau"></textarea>		Base64 <textarea id="base64u"></textarea>	</div>			<script>		var tileCountInputX = document.getElementById('tile-count-x');		var tileCountInputY = document.getElementById('tile-count-y');		var frameRateInput = document.getElementById('frame-rate');			var sourceVideo = document.getElementById('source-video');		var previewCanvas = document.getElementById('preview-canvas');		var previewCanvas2 = document.getElementById('preview-canvas2');				var DITHER_THRESHOLDS_4x4 = [			[1, 9, 3, 11],			[13, 5, 15, 7],			[4, 12, 2, 10],			[16, 8, 14, 6]		];				$('#botao-iniciar').click(function(){			sourceVideo.width = sourceVideo.videoWidth;			sourceVideo.height = sourceVideo.videoHeight;						var tileCountX = parseInt(tileCountInputX.value);			var tileCountY = parseInt(tileCountInputY.value);						previewCanvas.width = previewCanvas2.width = tileCountX * 8;			previewCanvas.height = previewCanvas2.height = tileCountY * 8;						var ctx2 = previewCanvas.getContext('2d');			var ctx3 = previewCanvas2.getContext('2d');						function computeFrame() {				var frameData = {					tiles:[]				};				ctx2.drawImage(sourceVideo, 0, 0, previewCanvas.width, previewCanvas.height);								var imgData = ctx2.getImageData(0, 0, previewCanvas.width, previewCanvas.height);				var w = previewCanvas.width;				var h = previewCanvas.height;								// Loop through rows of tiles				for (var ty = 0; ty != tileCountY; ty++) { 					// Loop through columns of tiles					for (var tx = 0; tx != tileCountX; tx++) { 						var tile = [];																	// Loop through rows of tile pixels						for (var py = 0; py != 8; py++) { 							var tileRow = [];													// Loop through columns of tile pixels							for (var px = 0; px != 8; px++) { 													var threshold = DITHER_THRESHOLDS_4x4[py & 0x03][px & 0x03],									x = tx * 8 + px,									y = ty * 8 + py,									ofs = (y * w + x) * 4,									color = imgData.data[ofs] * 17 / 255 > threshold ? 1 : 0;								tileRow.push(color);							}							tile.push(tileRow);						}						frameData.tiles.push(tile);					}				}								return frameData;			}						function drawTiles(frameData) {				var imgData = ctx3.getImageData(0, 0, previewCanvas.width, previewCanvas.height);				var w = previewCanvas.width;				var h = previewCanvas.height;								// Loop through rows of tiles				for (var ty = 0; ty != tileCountY; ty++) { 					// Loop through columns of tiles					for (var tx = 0; tx != tileCountX; tx++) { 						// Gets current tile						var tile = frameData.tiles[ty * tileCountX + tx];												// Loop through rows of tile pixels						for (var py = 0; py != 8; py++) { 							// Loop through columns of tile pixels							for (var px = 0; px != 8; px++) { 								var x = tx * 8 + px,									y = ty * 8 + py,									ofs = (y * w + x) * 4,									color = tile[py][px] * 255;								imgData.data[ofs] = color;								imgData.data[ofs + 1] = color;								imgData.data[ofs + 2] = color;								imgData.data[ofs + 3] = 255;							}						}					}				}				ctx3.putImageData(imgData, 0, 0);			}						var fpsRate = parseInt(frameRateInput.value);			var frameIncrement = 1 / fpsRate;			var currentTime = 0;			var duration = sourceVideo.duration; // Full//			var duration = 10; // 10 seconds			sourceVideo.onseeked = function() {				currentTime += frameIncrement;				if (currentTime >= duration) {										alert('Okay, it\'s done.');										return;				}								var frameData = computeFrame();				drawTiles(frameData);								/*				ctx3.mozImageSmoothingEnabled=false;				ctx3.drawImage(decodeCanvas, 0, 0, previewCanvas2.width, previewCanvas2.height);				*/								// Requests next frame				sourceVideo.currentTime = currentTime;			};			// Starts processing the frames			sourceVideo.currentTime = 0;		});	</script></body></html>